RewriteEngine On

# La base è /enryi/ perché il sito è in quella sottocartella
RewriteBase /enryi/

<IfModule mod_rewrite.c>
    RewriteEngine On

    # Se sei su localhost, forza la sottocartella /enryi
    RewriteCond %{HTTP_HOST} ^localhost$ [NC]
    RewriteCond %{REQUEST_URI} !^/enryi/ [NC]
    RewriteRule ^(.*)$ /enryi/$1 [L]

    # Se sei sul dominio, "togli" /enryi dalla URL esterna
    RewriteCond %{HTTP_HOST} ^enryi\.23hosts\.com$ [NC]
    RewriteCond %{REQUEST_URI} ^/enryi/(.*)$ [NC]
    RewriteRule ^enryi/(.*)$ /$1 [L]

    # (qui sotto le tue normali rewrite per index.php, login, ecc.)
    # Esempio:
    # RewriteCond %{REQUEST_FILENAME} !-f
    # RewriteCond %{REQUEST_FILENAME} !-d
    # RewriteRule . index.php [L]
</IfModule>

# File statici: non toccarli
RewriteRule \.(css|js|png|jpg|jpeg|gif|webp|svg|ico|woff|woff2|ttf|eot)$ - [L]

# URL senza estensione -> .php se esiste
# /login -> login.php
# /register -> register.php
# /comics -> comics.php
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME}.php -f
RewriteRule ^([a-zA-Z0-9_-]+)/?$ $1.php [QSA,L]

# URL senza estensione -> .html se esiste
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME}.html -f
RewriteRule ^([a-zA-Z0-9_-]+)/?$ $1.html [QSA,L]

# Regola specifica per /series/slug -> series/index.php
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^series/([^/]+)/?$ series/index.php [QSA,L]

# Se hai una cartella /pending/ con index.php
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^pending/?$ pending/index.php [QSA,L]

# Charset
AddDefaultCharset UTF-8

# Cache immagini
<IfModule mod_expires.c>
    ExpiresActive on
    ExpiresByType image/png "access plus 1 month"
    ExpiresByType image/jpg "access plus 1 month"
    ExpiresByType image/jpeg "access plus 1 month"
    ExpiresByType image/gif "access plus 1 month"
    ExpiresByType image/webp "access plus 1 month"
</IfModule>

# Errori personalizzati 300s
ErrorDocument 301 /enryi/errors/301.php

# Errori personalizzati 400s
ErrorDocument 401 /enryi/errors/401.php
ErrorDocument 403 /enryi/errors/403.php
ErrorDocument 404 /enryi/errors/404.php
ErrorDocument 408 /enryi/errors/408.php
ErrorDocument 429 /enryi/errors/429.php

# Errori personalizzati 500s
ErrorDocument 500 /enryi/errors/500.php
ErrorDocument 502 /enryi/errors/502.php
ErrorDocument 503 /enryi/errors/503.php
ErrorDocument 504 /enryi/errors/504.php

# Eccezioni per file specifici (Access Control)
Options -Indexes

<Files ".gitignore">
    Require all denied
</Files>

<Files "README.md">
    Require all denied
</Files>

<Files ".htaccess">
    Require all denied
</Files>